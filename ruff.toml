# ruff.toml - Ruff configuration for SecInterp QGIS Plugin
# https://docs.astral.sh/ruff/

# ============================================================================
# Global Settings
# ============================================================================
line-length = 100  # Compatible with Black
target-version = "py310"  # Python 3.10+

# Exclude directories and files from linting
exclude = [
    ".git",
    "__pycache__",
    "*.pyc",
    ".venv",
    "scripts",
    "venv",
    "env",
    ".env",
    "dist",
    "build",
    ".mypy_cache",
    ".ruff_cache",
    ".pytest_cache",
    "*.egg-info",
    # Project-specific exclusions
    "help",                          # Generated help files
    "resources/resources.py",        # Qt resources (auto-generated)
    "gui/ui/__init__.py",
    "**/migrations/**",
    # Tests (optional - remove if you want to lint tests)
    "**/test*.py",
    "**/*test.py",
    "tests/",
]

# ============================================================================
# Linting Rules
# ============================================================================
[lint]
# Select rule categories to enable
select = [
    "F",   # Pyflakes - basic errors
    "E",   # pycodestyle errors
    "W",   # pycodestyle warnings
    "I",   # isort - import sorting
    "N",   # pep8-naming
    "D",   # pydocstyle - docstring conventions
    "UP",  # pyupgrade - modern Python syntax
    "B",   # flake8-bugbear - common bugs
    "C4",  # flake8-comprehensions - better comprehensions
    "T20", # flake8-print - avoid print statements
    "SIM", # flake8-simplify - simplification suggestions
    "PTH", # flake8-use-pathlib - prefer pathlib
    "ISC", # flake8-implicit-str-concat
    "Q",   # flake8-quotes - quote consistency
    "TID", # flake8-tidy-imports
    "PL",  # Pylint
    "TRY", # tryceratops - better exception handling
    "RUF", # Ruff-specific rules
    "C90", # mccabe - complexity checking
]

# Rules to ignore (QGIS/PyQt5 specific)
ignore = [
    # === Code Style & Layout ===
    "E501",   # line-too-long
    "E402",   # module-import-not-at-top-of-file
    "PLC0415",# import-outside-top-level
    "PTH",    # flake8-use-pathlib
    "E722",   # bare-except (Legacy code often uses catch-all)

    # === QGIS/PyQt5 Compatibility ===
    "F821",   # undefined-name
    "N802",   # invalid-function-name (Qt camelCase)
    "N803",   # invalid-argument-name
    "N806",   # non-lowercase-variable-in-function
    "N815",   # mixedCase variable in class scope

    # === Complexity & Structure ===
    "C901",   # complex-structure (Allow complex legacy functions)
    "PLR0915",# too-many-statements
    "PLR0912",# too-many-branches
    "PLR0911",# too-many-return-statements
    "PLR0913",# too-many-arguments

    # === Import Management ===
    "F401",   # unused-import
    "I001",   # unsorted-imports (Handled by manual sort or fix)
    "UP035",  # deprecated-import (typing.List vs list)

    # === Docstring Flexibility ===
    "D100", "D101", "D102", "D103", "D104", "D105", "D106", "D107",
    "D203", "D213", "D205",

    # === Exception Handling & Misc ===
    "TRY003", # raise-vanilla-args
    "TRY300", # try-consider-else
    "TRY301", # raise-within-try
    "TRY401", # verbose-log-message
    "RUF001", # ambiguous-unicode-character-string (Allow emojis and dashes)
    "RUF012", # mutable-class-default
    "RUF059", # unused-unpacked-variable
    "RUF100", # unused-noqa
    "SIM102", # collapsible-if
    "PLR2004",# magic-value-comparison
    "PLW0603",# global-statement
    "PLW2901",# redefined-loop-name
    "PLC0206",# dict-index-missing-items
    "T201",   # print-found
    "F841",   # unused-variable
    "E741",   # ambiguous-variable-name
    "N818",   # error-suffix-on-exception-name
    "UP007", "UP045",
]

# Dummy variable pattern (matches .pylintrc)
dummy-variable-rgx = "^(_+|(_[a-zA-Z0-9_]*[a-zA-Z0-9]+?$)|dummy|^ignored_|^unused_)$"

# Rules that should never be auto-fixed
unfixable = [
    "F401",  # Don't auto-remove unused imports (might be intentional re-exports)
]

# ============================================================================
# Per-File Ignores
# ============================================================================
[lint.per-file-ignores]
# __init__.py files often have unused imports for re-export
"__init__.py" = ["F401", "D104"]

# GUI files often need camelCase for Qt overrides
"gui/**/*.py" = [
    "N802",   # invalid-function-name (camelCase for Qt)
    "N803",   # invalid-argument-name (camelCase for Qt)
    "N806",   # non-lowercase-variable-in-function (Qt constants)
    "N815",   # mixedCase variable in class scope (Qt signals)
]

# Test files can have more relaxed rules
"tests/**/*.py" = [
    "D100", "D101", "D102", "D103",  # Don't require docstrings in tests
    "PLR2004",  # Allow magic values in tests
    "S101",     # Allow assert statements
]

# Logger config can use print
"logger_config.py" = ["T201"]

# ============================================================================
# Code Formatting
# ============================================================================
[format]
# Black-compatible formatting
quote-style = "double"
indent-style = "space"
skip-magic-trailing-comma = false
line-ending = "auto"
docstring-code-format = true  # Format code in docstrings
docstring-code-line-length = 72  # Shorter lines in docstring examples

# ============================================================================
# Plugin-Specific Configurations
# ============================================================================

[lint.pydocstyle]
# Use Google-style docstrings
convention = "google"
# Ignore missing docstrings in magic methods
ignore-decorators = ["typing.overload"]

[lint.pylint]
# Complexity limits (from .pylintrc)
max-args = 7          # Maximum function arguments
max-branches = 12     # Maximum branches in function
max-locals = 15       # Maximum local variables
max-returns = 6       # Maximum return statements
max-statements = 50   # Maximum statements in function

[lint.isort]
# Import sorting configuration
known-first-party = ["sec_interp"]  # Your package name
known-third-party = ["enchant", "qgis", "PyQt5"]
section-order = [
    "future",
    "standard-library",
    "third-party",
    "first-party",
    "local-folder"
]
# Group imports by type
force-sort-within-sections = true
lines-after-imports = 2

[lint.mccabe]
# Maximum cyclomatic complexity
max-complexity = 12

[lint.flake8-bugbear]
# Allow default mutable arguments in dataclasses
extend-immutable-calls = ["fastapi.Depends", "fastapi.Query"]

[lint.flake8-quotes]
# Enforce double quotes (consistent with Black)
inline-quotes = "double"
multiline-quotes = "double"
docstring-quotes = "double"

[lint.flake8-tidy-imports]
# Ban certain imports
ban-relative-imports = "parents"  # Allow same-level relative imports, ban parent imports

[lint.pyupgrade]
# Keep runtime-required type checking imports
keep-runtime-typing = true
